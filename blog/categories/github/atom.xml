<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: github | @znz blog]]></title>
  <link href="http://blog.n-z.jp/blog/categories/github/atom.xml" rel="self"/>
  <link href="http://blog.n-z.jp/"/>
  <updated>2013-11-23T21:43:03+09:00</updated>
  <id>http://blog.n-z.jp/</id>
  <author>
    <name><![CDATA[Kazuhiro NISHIYAMA]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[anyenvやrbenvのpluginsの更新などをしやすくするプラグインを作った]]></title>
    <link href="http://blog.n-z.jp/blog/2013-11-21-anyenv-rbenv-plugins.html"/>
    <updated>2013-11-21T18:25:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/anyenv-rbenv-plugins</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/sstephenson/rbenv">rbenv</a>
には
<a href="https://github.com/rkh/rbenv-update">rbenv-update</a>
というプラグインがあって、アップデートだけは簡単にできるのに、
他の <code>git</code> の操作をまとめて実行するのが面倒なので、
まとめて実行できる
<a href="https://github.com/znz/rbenv-git">rbenv-git</a>
というプラグインを作りました。</p>

<p>それから
<a href="https://github.com/riywo/anyenv">anyenv</a>
の方でもすべての <code>**env</code> も含めてアップデートできると便利だと思い、
<a href="https://github.com/znz/anyenv-update">anyenv-update</a>
と
<a href="https://github.com/znz/anyenv-git">anyenv-git</a>
を作成しました。</p>

<!--more-->


<h2>インストール</h2>

<p>それぞれ <code>plugins</code> のディレクトリの中に <code>git clone</code> でとってくるだけです。</p>

<ul>
<li><code>git clone https://github.com/znz/rbenv-git.git $(rbenv root)/plugins/rbenv-git</code></li>
<li><code>git clone https://github.com/znz/anyenv-update.git $(anyenv root)/plugins/anyenv-update</code></li>
<li><code>git clone https://github.com/znz/anyenv-git.git $(anyenv root)/plugins/anyenv-git</code></li>
</ul>


<p><code>README</code> の方には <code>mkdir -p $(anyenv root)/plugins</code> も書いていますが、
git version 1.8.4.3 だと不要で、自動で親ディレクトリも作ってくれるようです。
git のどのバージョンからなのかわからないので、
<code>README</code> には <code>mkdir -p</code> を残しています。</p>

<h2>使い方</h2>

<h3>rbenv git</h3>

<p><code>rbenv</code> と <code>rbenv</code> のプラグインの <code>git</code> 操作をまとめて実行できます。</p>

<p><code>rbenv git pull</code> で <code>rbenv update</code> の代用が出来ます。
<code>rbenv update</code> だと <code>rbenv</code> 自体を homebrew で入れている時にも
<code>RBENV_ROOT</code> で <code>git</code> コマンドを実行してしまいますが、
<code>rbenv git</code> なら大丈夫です。</p>

<p><code>rbenv git gc</code> で cleanup も出来ます。</p>

<p><code>rbenv git remote -v</code> でどこからとってきたのか確認したり、
<code>rbenv git status</code> でローカルで何か変更しているかどうか確認したりも出来ます。</p>

<h3>anyenv update</h3>

<p><code>anyenv update</code> で</p>

<ul>
<li><code>anyenv</code></li>
<li><code>anyenv</code> のプラグイン</li>
<li><code>**env</code></li>
<li><code>**env</code> のプラグイン</li>
</ul>


<p>がアップデートできます。</p>

<p>git 管理ではないものは skip します。</p>

<h3>anyenv git</h3>

<p><code>rbenv git</code> と同様の操作が
<code>anyenv update</code> と同様の対象に
まとめて実行できます。</p>

<ul>
<li><code>anyenv git pull</code></li>
<li><code>anyenv git gc</code></li>
<li><code>anyenv git remote -v</code></li>
<li><code>anyenv git status</code></li>
</ul>


<p>など、
<code>git</code> の各種操作ができます。</p>

<h2>裏話</h2>

<p>最初は <code>rbenv update</code> のコードを fork しようとしていたのですが、
ライセンスが明記されていなかったので止めて、
他の MIT License と明示されているプラグインを主に参考にして作りました。
他にも <code>set -eo pipefail</code> というのは
<a href="https://github.com/progrium/dokku">dokku</a>
を参考にしました。</p>

<p>ライセンスが不明だと参考にするのにも困るので、
github のレポジトリを作成する時の LICENSE ファイルそのままだけでも良いので、
どういうライセンスにしたいのか明記されているとありがたいと思いました。</p>

<h2>追記</h2>

<p><code>rbenv update</code> だと <code>git pull</code> ではなく、毎回</p>

<p>```</p>

<pre><code>git checkout master
git fetch origin
git pull origin master
</code></pre>

<p>```</p>

<p>を実行していて遅いというのも <code>rbenv git</code> などを作った理由のひとつというのを
書き忘れていたので、追記しておきます。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rbenvのプラグインを簡単に追加出来るようにするrbenv-plugを作った]]></title>
    <link href="http://blog.n-z.jp/blog/2013-10-29-rbenv-plug.html"/>
    <updated>2013-10-29T23:55:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/rbenv-plug</id>
    <content type="html"><![CDATA[<p><a href="https://github.com/sstephenson/rbenv">rbenv</a> のプラグインをインストールするのに
<code>git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build</code>
のように <code>ruby-build</code> を二回指定しないといけなかったり、
git の URL をコピペしないといけなかったりして面倒なので、
簡単にインストールできるようにするプラグイン
<a href="https://github.com/znz/rbenv-plug">rbenv-plug</a>
を作りました。</p>

<p><a href="https://github.com/sstephenson/ruby-build">ruby-build</a>
のように <code>share</code> の下に一覧を持つようにしたので、
インストールできるプラグインは簡単に増やせます。</p>

<!--more-->


<h2>使い方</h2>

<p><a href="https://github.com/znz/rbenv-plug">README</a> に書いた通りです。</p>

<p><a href="https://github.com/sstephenson/rbenv/wiki/Plugins">plugins</a>
に載っているプラグインなら以下のように簡単にインストールできます。</p>

<pre><code>rbenv plug &lt;plugin-name&gt;
</code></pre>

<p>例えば
<a href="https://github.com/sstephenson/ruby-build">ruby-build</a>
をインストールするなら以下のようになります。</p>

<pre><code>rbenv plug ruby-build
</code></pre>

<p>例えば
<a href="https://github.com/rkh/rbenv-update">rbenv-update</a>
をインストールするなら、</p>

<pre><code>rbenv plug rbenv-update
</code></pre>

<p>のようにするか、
<code>rbenv-</code>
を省略して以下のようにします。</p>

<pre><code>rbenv plug update
</code></pre>

<p>git の URL を指定して任意のプラグインをインストールすることもできます。</p>

<pre><code>rbenv plug https://github.com/sstephenson/ruby-build.git
</code></pre>

<p>アンインストールも簡単にできます。
例えば
<code>rbenv-update</code>
をアンインストールするなら、</p>

<pre><code>rbenv unplug rbenv-update
</code></pre>

<p>のようにするか、
<code>rbenv-</code>
を省略して以下のようにします。</p>

<pre><code>rbenv unplug update
</code></pre>

<h2>インストール方法</h2>

<p>以下のようにプラグインの一般的なインストール方法そのままで、
<code>$RBENV_ROOT/plugins</code> に <code>git clone</code> するだけです。</p>

<pre><code>mkdir -p ~/.rbenv/plugins
git clone https://github.com/znz/rbenv-plug.git ~/.rbenv/plugins/rbenv-plug
</code></pre>

<h2>仕組み</h2>

<p>URL が指定された時は上の一般的なインストール方法と同様のことを実行するだけです。</p>

<p>プラグイン名を指定された時は
<code>share/rbenv-plug</code>
の中のスクリプトを実行します。</p>

<p>名前が <code>rbenv-</code> で始まるプラグインがほとんどなので、
<code>rbenv plug</code> や <code>rbenv unplug</code> の引数では
<code>rbenv-</code> を省略できるようにしました。</p>

<p><code>share/rbenv-plug</code> のスクリプトで
<a href="https://github.com/tpope/rbenv-aliases">rbenv-aliases</a>
なら <code>rbenv alias --auto</code> を追加で実行したり、
<a href="https://github.com/rkh/rbenv-use">rbenv-use</a>
なら依存している <code>rbenv-whatis</code> もインストールしたりしています。</p>

<h2>余談</h2>

<p><code>share/rbenv-plug</code> のファイルを追加している時に
<a href="https://github.com/taqtiqa/rbenv-plugin">rbenv-plugin</a>
というのがあって、
今の <code>rbenv-plug</code> (と <code>rbenv-unplug</code>) という名前に変えました。
最初は <code>rbenv-plugin-install</code> (と <code>rbenv-plugin-uninstall</code>)
という名前で作りかけていたので、
<code>rbenv-plugin</code> のサブコマンドと思いっきり名前がかぶっていました。
<code>rbenv-plugins-install</code> という複数形の名前も使われてしまっていたので、
思い切って短い名前に変更しました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[www.ruby-lang.org への pull request の出し方]]></title>
    <link href="http://blog.n-z.jp/blog/2013-09-30-how-to-pull-request.html"/>
    <updated>2013-09-30T22:43:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/how-to-pull-request</id>
    <content type="html"><![CDATA[<p><a href="https://www.ruby-lang.org/en/news/2013/09/23/ruby-2-1-0-preview1-is-released/">Ruby 2.1.0-preview1 is released</a>
というアナウンスが一週間経ってもまだ日本語訳が出来ていなかったので、
ちょっとの暇を見つけて pull request を出してみたので、
その手順をまとめておきます。</p>

<!--more-->


<p>まず github のアカウントは持っているというのは前提として話を進めます。</p>

<p>初回は
<a href="https://github.com/ruby/www.ruby-lang.org">https://github.com/ruby/www.ruby-lang.org</a>
の右上から自分のアカウントに Fork します。</p>

<p>すでに Fork していて二回目以降は upstream の変更を merge する必要があります。
<a href="https://help.github.com/articles/syncing-a-fork">Syncing a fork</a>
を参考にして merge します。</p>

<p>実行したコマンドだけまとめておきます。
詳細は github のヘルプを参照してください。</p>

<p><code>console
% git clone git@github.com:znz/www.ruby-lang.org.git
% cd www.ruby-lang.org
% git remote add upstream https://github.com/ruby/www.ruby-lang.org.git
% git remote -v
% git fetch upstream
% git branch -va
% git checkout master
% git merge upstream/master
% git push
</code></p>

<p>英語版を元にして日本語版を作成します。</p>

<p><code>console
% cp {en,ja}/news/_posts/2013-09-23-ruby-2-1-0-preview1-is-released.md
% git add ja/news/_posts/2013-09-23-ruby-2-1-0-preview1-is-released.md
% vi ja/news/_posts/2013-09-23-ruby-2-1-0-preview1-is-released.md
</code></p>

<p>プレビュー用に <code>bundle install</code> します。</p>

<p><code>console
% bundle install
% rake -T
% rake preview
</code></p>

<p><code>rake preview</code>
でサーバーが起動しているので、
ブラウザで
<code>http://localhost:4000/</code>
を開いて表示を確認します。</p>

<p>github に push して、
ブラウザから pull request を出します。</p>

<p>ブランチを切り忘れていたので、
ここで作りました。</p>

<p><code>console
% git checkout -b ruby210preview1
% git commit -av
% git push --set-upstream origin ruby210preview1
</code></p>

<p>最後に
<code>git checkout master</code>
で master ブランチに戻るなり、
消してしまって、
また作業する時に clone し直すなりします。</p>
]]></content>
  </entry>
  
</feed>
