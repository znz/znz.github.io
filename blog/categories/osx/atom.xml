<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: osx | @znz blog]]></title>
  <link href="http://blog.n-z.jp/blog/categories/osx/atom.xml" rel="self"/>
  <link href="http://blog.n-z.jp/"/>
  <updated>2014-04-24T00:11:45+09:00</updated>
  <id>http://blog.n-z.jp/</id>
  <author>
    <name><![CDATA[Kazuhiro NISHIYAMA]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[第 10 回 RubyMotion もくもく会 in Osaka に参加した]]></title>
    <link href="http://blog.n-z.jp/blog/2014-04-23-rubymotion-mokumoku.html"/>
    <updated>2014-04-23T19:16:51+09:00</updated>
    <id>http://blog.n-z.jp/blog/rubymotion-mokumoku</id>
    <content type="html"><![CDATA[<p>第 1 回から第 9 回にも参加した RubyMotion もくもく会 in Osaka の
<a href="http://connpass.com/event/5674/">第 10 回 RubyMotion もくもく会 in Osaka</a>
に参加してきました。</p>

<p>次回の
<a href="http://connpass.com/event/6116/">第 11 回 RubyMotion もくもく会 in Osaka &ndash; connpass</a>
は 05/28(水) になりました。</p>

<!--more-->


<h2>メモ</h2>

<ul>
<li><a href="https://itunes.apple.com/jp/app/bokosuka!mogurando/id845835380?mt=8">ボコスカ！モグランド</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4873116678/ref=as_li_ss_tl?ie=UTF8&amp;camp=247&amp;creative=7399&amp;creativeASIN=4873116678&amp;linkCode=as2&amp;tag=znz-22">AngularJSアプリケーション開発ガイド</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=znz-22&amp;l=as2&amp;o=9&amp;a=4873116678" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> が発売されているという話</li>
<li><a href="http://www.pixate.com/">Pixate</a></li>
<li>MacFace</li>
<li><a href="https://github.com/HipByte/RubyMotionSamples/issues/31">osx/Tweets app crashes on launch</a></li>
<li><a href="http://www.impress-plus.co.jp/">http://www.impress-plus.co.jp/</a></li>
</ul>


<h2>調査続き</h2>

<p>引き続き初回起動時の URL の受け取り方を調べていました。</p>

<ul>
<li><a href="http://questbeat.hatenablog.jp/entry/2014/04/19/123207">「ログイン時に起動」を実装する</a> はあんまり関係なかった。</li>
<li>GitHub で <code>LSSetDefaultHandlerForURLScheme</code> を検索

<ul>
<li><a href="https://github.com/s-faychatelard/Helm/blob/2c85b303781fa430432c17ed9848a0b252c82eae/sources/others/mac/mac.mm">https://github.com/s-faychatelard/Helm/blob/2c85b303781fa430432c17ed9848a0b252c82eae/sources/others/mac/mac.mm</a> : Qt で実装していて URL を受け取っている部分がわからず (Qt のイベントに変換されたものを受け取っている?)</li>
<li><a href="https://github.com/bigbearlabs/MotionKit/blob/51f46c14b52819b709c57d6e1c954d84c852e48b/lib/motion-kit/misc/osx/osx_browsers.rb">https://github.com/bigbearlabs/MotionKit/blob/51f46c14b52819b709c57d6e1c954d84c852e48b/lib/motion-kit/misc/osx/osx_browsers.rb</a> : ブラウザーの一覧の取得など</li>
<li><a href="https://github.com/bigbearlabs/MotionKit/blob/51f46c14b52819b709c57d6e1c954d84c852e48b/lib/motion-kit/app/osx/app.rb">https://github.com/bigbearlabs/MotionKit/blob/51f46c14b52819b709c57d6e1c954d84c852e48b/lib/motion-kit/app/osx/app.rb</a> : <code>application:openFile:</code> や <code>application:openFiles:</code> で受け取っているように見えるが試してみても呼ばれない。</li>
<li><a href="https://github.com/gnyrd/WebEx/blob/0ea21241591e496d1d702c45768400fa14d75662/URLHandler.m">https://github.com/gnyrd/WebEx/blob/0ea21241591e496d1d702c45768400fa14d75662/URLHandler.m</a> : <code>kAEGetURL</code> の登録に <code>handleGetURLEvent:withReplyEvent:</code> (2引数) ではなく <code>getURL:</code> (1引数) を使っている。</li>
</ul>
</li>
</ul>


<p>前回までの試行錯誤の途中で <code>setEventHandler</code> の呼び出しを <code>applicationDidFinishLaunching:</code> から <code>initialize</code> に移動していたのと <code>getURL:</code> への変更の組み合わせで、やっと初回起動時にも URL が受け取れるようになって、
さらに <code>rake clean</code> したり一度デフォルトブラウザーを他のブラウザーに設定し直したりしていたら、
<code>handleGetURLEvent:withReplyEvent:</code> に戻しても初回起動時に受け取れるようになっていました。</p>

<p>原因がはっきりしないのが嫌な感じですが、何か設定が中途半端に残っているとうまく動かなかったようです。</p>

<h2>RubyMine</h2>

<p>前回のもくもく会でインストールして、他では使っていなかったので、
ほぼ使っていないまま登録せず試用期限が切れてしまって、
30分ごとに終了するようになってしまいました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[homebrew cask で sylpheed test1 をインストールした]]></title>
    <link href="http://blog.n-z.jp/blog/2014-04-21-brew-cask-sylpheed.html"/>
    <updated>2014-04-21T23:00:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/brew-cask-sylpheed</id>
    <content type="html"><![CDATA[<p><a href="http://sylpheed.sraoss.jp/ja/news.html">Sylpheed 3.4.1-test1 for Mac OS X (テスト版)</a>
がリリースされていたので、
homebrew cask を使ってインストールしてみました。</p>

<p>dmg で配布されているアプリケーションを homebrew cask に対応させる例としても参考になると思います。</p>

<!--more-->


<h2>homebrew cask のインストール</h2>

<p><a href="http://brew.sh/">Homebre</a>
と
<a href="https://github.com/phinze/homebrew-cask">homebrew-cask</a>
をあらかじめインストールしておきます。</p>

<h2>cask 作成</h2>

<p><code>brew cask create sylpheed-test</code> で作成して、
内容を以下のように変更しました。</p>

<p><code>ruby
class SylpheedTest &lt; Cask
  url 'http://sylpheed.sraoss.jp/sylpheed/macosx/Sylpheed_3.4.1-test1.dmg'
  homepage 'http://sylpheed.sraoss.jp/'
  version '3.4.1-test1'
  sha256 '52505ab7913fd58fa921a9c8b574286f08073321b440b7aa23dba3896b4b2ddc'
  link 'Sylpheed.app'
end
</code></p>

<p><code>sha256</code> は
<a href="https://github.com/phinze/homebrew-cask/blob/master/CONTRIBUTING.md#cask-stanzas">Cask Stanzas</a>
の説明にあるように別途 <code>url</code> に指定したファイルをダウンロードして <code>shasum -a 256 &lt;file&gt;</code> で調べました。
もし upstream のリリースアナウンスに書いてあれば、それをそのまま使えば良いと思います。</p>

<p>編集途中で閉じてしまった場合は
<code>brew cask edit sylpheed-test</code>
で再編集できます。</p>

<p>実体は <code>$(brew --prefix)/Library/Taps/phinze-cask/Casks/sylpheed-test.rb</code> にあります。</p>

<h2>インストール</h2>

<p><code>sylpheed-test.rb</code> が作成できたら <code>brew cask install sylpheed-test</code> でインストールできます。</p>

<p>```console
% brew cask install sylpheed-test
==> Downloading <a href="http://sylpheed.sraoss.jp/sylpheed/macosx/Sylpheed_3.4.1-test1.dmg">http://sylpheed.sraoss.jp/sylpheed/macosx/Sylpheed_3.4.1-test1.dmg</a></p>

<h6>################################################################## 100.0%</h6>

<p>==> Symlinking App &lsquo;Sylpheed.app&rsquo; to &lsquo;/Users/kazu/Applications/Sylpheed.app&rsquo;
🍺  sylpheed-test installed to &lsquo;/opt/homebrew-cask/Caskroom/sylpheed-test/3.4.1-test1&rsquo; (314 files, 32M)
```</p>

<h2>起動</h2>

<p>Launchpad から起動したり、Spotlight で検索したりして普通に起動します。</p>

<p>初回起動で
<code>~/Library/Application Support/Sylpheed/Mailboxes/Mail</code>
を作るかきかれましたが、その時点で既に
<code>~/Library/Application Support/Sylpheed</code>
は作成されていました。</p>

<h2>まとめ</h2>

<p>テスト版なので、まだ変なところはあるようですが (Command+V がメッセージビューのトグルになってペーストできないとか)
Mac OS X 版特有の問題があるだけのようなので、今後の正式版に期待しています。</p>

<p>まだ test 版なので pull request はしていないのですが、
正式版が出たら homebrew cask に pull request を送るかもしれません。
beta 版なども対応するなら
<a href="https://github.com/caskroom/homebrew-versions">homebrew-cask-versions</a>
に pull request を送ると良さそうです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[第 9 回 RubyMotion もくもく会 in Osaka に参加した]]></title>
    <link href="http://blog.n-z.jp/blog/2014-03-19-rubymotion-mokumoku-osaka.html"/>
    <updated>2014-03-19T19:32:08+09:00</updated>
    <id>http://blog.n-z.jp/blog/rubymotion-mokumoku-osaka</id>
    <content type="html"><![CDATA[<p>第 1 回から第 8 回にも参加した RubyMotion もくもく会 in Osaka の
<a href="http://connpass.com/event/5276/">第 9 回 RubyMotion もくもく会 in Osaka</a>
に参加してきました。</p>

<p>次回の
<a href="http://connpass.com/event/5674/">第 10 回 RubyMotion もくもく会 in Osaka</a>
は 4/23(水) になりました。</p>

<!--more-->


<h2>メモ</h2>

<ul>
<li><a href="https://github.com/shin1x1/vagrantx/issues/1">VagrantX のロゴ</a></li>
<li><a href="http://www.jetbrains.com/ruby/">RubyMine</a></li>
<li><a href="http://testflightapp.com/">TestFlight</a> の代わりに今は <a href="https://deploygate.com/">DeployGate</a> が良いという話</li>
</ul>


<h2>やったこと</h2>

<p>RubyMine をインストールして使い始めてみました。
試用期間は次回のもくもく会には切れているので、
それまでに他でも使っておかないとあっという間に試用期間が終わってしまいそうです。</p>

<p><a href="http://stackoverflow.com/questions/9289613/handlegeturlevent-doesnt-get-called">イベントハンドラの設定を init でやれば良い</a>というような話があったので、
init メソッドを定義してみたところ、呼ばれていなかったので、
initialize にしてみたら、
呼ばれていることは確認できても、
やっぱり起動時の URL は受け取れないままでした。</p>

<p>内部的な変更としては
REPL で確認した時に
<code>KeyDirectObject</code> が存在しなかったので、
<code>keyDirectObject = '----'.unpack('L')[0]</code>
のように作っていたのを
<code>KeyDirectObject</code>
を使うように変えました。</p>

<p>以前のもくもく会の時に気付いたように
<code>rake</code>
でのコンパイル時に参照していない定数は REPL でも存在しないというだけでした。</p>

<p>他にはいろいろ調べている時に
<a href="http://vivacocoa.jp/objective-c3e/chapter5c.html">ウィンドウのクローズとアプリケーションの終了を同期させる</a>
というのを知ったので、
以下のメソッド定義を追加して
window を閉じた時に終了するようにしました。
これを追加するまでは閉じたら開き直す手段がなくて何も出来なくなっていました。</p>

<p>```ruby app/app_delegate.rb
  def applicationShouldTerminateAfterLastWindowClosed(application)</p>

<pre><code>true
</code></pre>

<p>  end
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[第 8 回 RubyMotion もくもく会 in Osaka に参加した]]></title>
    <link href="http://blog.n-z.jp/blog/2014-02-19-rubymotion-mokumoku-osaka.html"/>
    <updated>2014-02-19T19:27:12+09:00</updated>
    <id>http://blog.n-z.jp/blog/rubymotion-mokumoku-osaka</id>
    <content type="html"><![CDATA[<p>第 1 回から第 7 回にも参加した RubyMotion もくもく会 in Osaka の
<a href="http://connpass.com/event/4910/">第 8 回 RubyMotion もくもく会 in Osaka</a>
に参加してきました。</p>

<p>次回の
<a href="http://connpass.com/event/5276/">第 9 回 RubyMotion もくもく会 in Osaka</a>
は 3/19(水) になりました。</p>

<!--more-->


<h2>話に出たもの</h2>

<p>話に出てきたサイトなどのメモです。</p>

<ul>
<li><a href="http://connpass.com/event/5274/">iBeacon 勉強会（入門編）</a></li>
<li><a href="http://japan.gamesalad.com/">GameSalad</a></li>
<li><a href="http://www.hirotangame.net/">広探ゲーム</a></li>
</ul>


<h2>もくもく</h2>

<p>ブラウザを開くのに <code>open</code> コマンドを経由から <code>NSWorkspace</code> の <code>openURLs:withAppBundleIdentifier:options:additionalEventParamDescriptor:launchIdentifiers:</code> 経由に変更しました。</p>

<p>```ruby
  def openBrowser(app, *args)</p>

<pre><code>r, w = IO.pipe
pid = Process.spawn('open', '-a', app, @text.stringValue, *args, [:out, :err] =&gt; w)
w.close
pid, status = Process.waitpid2(pid)
output = r.read
r.close
unless status.success?
  alert = NSAlert.new
  alert.messageText = "Failed to open #{app}\n\n#{output}"
  alert.runModal
end
</code></pre>

<p>  end
```</p>

<p><code>open -b</code> を使っていれば引数は変わらなかったのですが、 <code>open -a</code> を使っていたので、引数がアプリケーション名からバンドル ID に変わりました。</p>

<p><code>open -a 'Google Chrome' http://localhost:4000/ --args -incognito</code> の <code>-incognito</code> のような追加引数の渡し方がわからなかったので、 Chrome のシークレットウインドウを直接開く機能はなくしました。</p>

<p>```ruby
  NSWorkspaceLaunchAsync = 0x00010000
  NSWorkspaceLaunchAllowingClassicStartup = 0x00020000
  NSWorkspaceLaunchDefault = NSWorkspaceLaunchAsync | NSWorkspaceLaunchAllowingClassicStartup</p>

<p>  def openBrowser(app_bundle_id)</p>

<pre><code>url = NSURL.URLWithString @text.stringValue
ret = NSWorkspace.sharedWorkspace.openURLs([url], withAppBundleIdentifier: app_bundle_id, options: NSWorkspaceLaunchDefault, additionalEventParamDescriptor: nil, launchIdentifiers: nil)
unless ret
  alert = NSAlert.new
  alert.messageText = "Failed to open #{app}"
  alert.runModal
end
</code></pre>

<p>  end
```</p>

<p><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Workspace/Articles/WorkspaceServices.html">Workspace Services Programming Topics: Manipulating Files</a>
には <code>openURL:</code> しか書いてなかったり、
<code>additionalEventParamDescriptor</code> には何を渡せばいいのかわかりにくかったりして困りましたが、
<a href="http://www.lancard.com/blog/2011/05/01/open-url-with-browser-about-mac-app/">http://www.lancard.com/blog/2011/05/01/open-url-with-browser-about-mac-app/</a>
のように呼び出せばうまくいきました。</p>

<p>最初に <code>rake</code> の REPL で試していたら、以下のエラーになるので、しばらく悩んでいましたが、 <code>app/app_delegate.rb</code> の中に書けば動いたので、 <code>rake</code> でコンパイルされるタイミングでリンクできていないメソッドは呼び出せないということなのかと思いました。</p>

<p>```console
(main)> url = NSURL.URLWithString(&ldquo;<a href="http://www.apple.com">http://www.apple.com</a>&rdquo;)
=> #&lt;NSURL:0x7fcbe8e45060>
(main)> NSWorkspaceLaunchAsync = 0x00010000
=> 65536
(main)> NSWorkspaceLaunchAllowingClassicStartup = 0x00020000
=> 131072
(main)> NSWorkspaceLaunchDefault = NSWorkspaceLaunchAsync | NSWorkspaceLaunchAllowingClassicStartup
=> 196608
(main)> NSWorkspace.sharedWorkspace.openURLs([url], withAppBundleIdentifier: &ldquo;com.google.Chrome&rdquo;, options: NSWorkspaceLaunchDefault, additionalEventParamDescriptor: nil, launchIdentifiers: nil)
dyld: lazy symbol binding failed: Symbol not found: __ZN9RoxorCore14find_bs_cftypeESs
  Referenced from: /Library/RubyMotion/data/osx/librubymotion-repl.dylib
  Expected in: flat namespace</p>

<p>dyld: Symbol not found: __ZN9RoxorCore14find_bs_cftypeESs
  Referenced from: /Library/RubyMotion/data/osx/librubymotion-repl.dylib
  Expected in: flat namespace</p>

<p>================================================================================
The application terminated. A crash report file may have been generated by the
system, use <code>rake crashlog' to open it. Use</code>rake debug=1' to restart the app</p>

<h1>in the debugger.</h1>

<p>```</p>

<h2>NSDate</h2>

<p>途中 <code>NSDate.distantFuture</code> の返り値がおかしいという話がありました。</p>

<p><code>
(main)&gt; NSDate.distantFuture
=&gt; 1677-09-21 09:12:43 +0900
(main)&gt; NSDate.distantPast
=&gt; 1677-09-21 09:12:43 +0900
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emacsやdistnotedを安定させるパッチをhomebrewで適用した]]></title>
    <link href="http://blog.n-z.jp/blog/2014-01-29-emacs-distnoted-patch.html"/>
    <updated>2014-01-29T15:59:28+09:00</updated>
    <id>http://blog.n-z.jp/blog/emacs-distnoted-patch</id>
    <content type="html"><![CDATA[<p>Emacs で distnoted が大変なことになる件で、
さらにコメントで追加の情報があったので、
homebrew でのインストール時に
追加のパッチをあてるようにしました。</p>

<!--more-->


<h2>パッチ適用</h2>

<p>適用法としては
<code>brew edit emacs</code>
で以下のように変更して、
<code>brew reinstall emacs</code>
で再インストールしました。
その後の <code>brew update</code> で引っかかる原因になるので、
reinstall したら <code>brew edit emacs</code> で戻しました。</p>

<p>適用されればどこでも良いのですが、最後に追加するようにしてみました。</p>

<p>```diff
diff &mdash;git a/Library/Formula/emacs.rb b/Library/Formula/emacs.rb
index db7c46c..26ec334 100644
&mdash;&ndash; a/Library/Formula/emacs.rb
+++ b/Library/Formula/emacs.rb
@@ -49,6 +49,7 @@ class Emacs &lt; Formula</p>

<pre><code> if build.include? "cocoa" and build.include? "japanese"
   p[:p0].push("http://sourceforge.jp/projects/macemacsjp/svn/view/inline_patch/trunk/emacs-inline.patch?view=co&amp;revision=583&amp;root=macemacsjp&amp;pathrev=583")
 end
</code></pre>

<ul>
<li> p[:p1].push &ldquo;<a href="https://gist.github.com/anonymous/8553178/raw/c0ddb67b6e92da35a815d3465c633e036df1a105/emacs.memory.leak.aka.distnoted.patch.diff">https://gist.github.com/anonymous/8553178/raw/c0ddb67b6e92da35a815d3465c633e036df1a105/emacs.memory.leak.aka.distnoted.patch.diff</a>&rdquo;
 p
end unless build.head?</li>
</ul>


<p>```</p>

<h2>しばらく使ってみて</h2>

<p>inline patch をあてたり外したりして試していた時は時々突然 Emacs 自体が落ちていたのですが、このパッチにしてからは起きていないようです。</p>

<h2>japanese パッチ問題</h2>

<p>別の話として、ことえりの日本語入力の確定直後になぜか「英字」入力状態になってしまうことがあって、カーソルを動かさないと直らないという現象が以前から起きています。
これは inline patch と mavericks の組み合わせで発生しているようなのですが、原因は調べられていません。</p>

<p>文章を入力しにくくなるので、今は</p>

<p><code>
brew uninstall emacs
brew install emacs --cocoa --srgb --with-gnutls
brew linkapps
</code></p>

<p>という感じで <code>--japanese</code> は外した状態でインストールしています。</p>

<p>homebrew でオプションの追加は <code>brew reinstall emacs --japanese</code> のように <code>reinstall</code> でも出来るのに、
外す方は <code>reinstall</code> だと出来ないようなので、
<code>uninstall</code> してから <code>install</code> し直しています。</p>
]]></content>
  </entry>
  
</feed>
