<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ubuntu | @znz blog]]></title>
  <link href="http://blog.n-z.jp/blog/categories/ubuntu/atom.xml" rel="self"/>
  <link href="http://blog.n-z.jp/"/>
  <updated>2013-12-07T02:12:02+09:00</updated>
  <id>http://blog.n-z.jp/</id>
  <author>
    <name><![CDATA[Kazuhiro NISHIYAMA]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[aptitude検索パターンの紹介]]></title>
    <link href="http://blog.n-z.jp/blog/2013-12-04-aptitude-search-pattern.html"/>
    <updated>2013-12-04T00:00:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/aptitude-search-pattern</id>
    <content type="html"><![CDATA[<p>Debian や Ubuntu のパッケージのインストールなどで
コマンドライン操作では <code>apt-get</code> や <code>aptitude</code>
を使いますが、
ここでは
<code>apt-get</code> では出来ない <code>aptitude</code>
の便利な使い方を紹介します。</p>

<p>この投稿は
<a href="http://qiita.com/advent-calendar/2013/distro-pm">ディストリビューション/パッケージマネージャー Advent Calendar 2013</a>
の4日目の記事です。</p>

<!--more-->


<h2>残ってしまった設定ファイルの削除</h2>

<p>deb パッケージのアンインストールは <code>remove</code> と <code>purge</code> の二種類があって、
<code>purge</code> すれば設定ファイルまで消えるのですが、
<code>remove</code> だと設定ファイルは残ってしまいます。</p>

<p>普段は
<code>apt-get purge hoge</code>
や
<code>aptitude purge hoge</code>
で削除していたとしても、
依存関係で自動インストールされたものが
自動削除される時は <code>remove</code> になってしまって
設定ファイルが残ってしまいます。</p>

<p>そういうときに <code>aptitude</code> だと</p>

<p><code>
aptitude purge '~c'
</code></p>

<p>で設定ファイルだけ残ったパッケージを一気に <code>purge</code> できます。</p>

<p>この <code>~c</code> というのが <code>aptitude</code> の search term の一種で、
削除されていて <code>purge</code> (完全削除) されていない、
つまり設定ファイルがシステム上に残っているパッケージという意味になります。</p>

<h2>クオートの必要性</h2>

<p><code>''</code> でクオートしているのはシェルの展開を抑制するためで、
必須ではないのですが、
環境によって意図しない指定になることを避けるために、
常に <code>''</code> でくくっておくことをお勧めします。
ちなみに、この例だと <code>c</code> というユーザーが存在した場合に
そのホームディレクトリに展開されてしまいます。</p>

<h2>長い形式と短い形式</h2>

<p>ほとんどの search term は短い形式 (short form) と
長い形式 (long form) があり、
<code>~c</code> が短い形式で対応する長い形式は <code>?config-files</code>
になります。
つまり</p>

<p><code>
aptitude purge '?config-files'
</code></p>

<p>でも同じ意味になります。</p>

<h2>検索パターンの確認</h2>

<p><code>aptitude search</code> でも <code>aptitude purge</code> でも <code>aptitude install</code> でも
同じように使えるので、
<code>aptitude search</code> で確認してから <code>aptitude purge</code> するとか、
<code>aptitude install</code> するという使い方も出来ます。</p>

<h2>Search Term reference</h2>

<p>search term の一覧は <code>aptitude-doc-ja</code> パッケージを入れて参照するか、
<a href="http://aptitude.alioth.debian.org/doc/ja/ch02s04s05.html">Search term reference</a>
などを参照してください。</p>

<h2>他によく使っている search term</h2>

<p>他によく使っているものとしては、</p>

<p><code>
aptitude search '~U'
</code></p>

<p>でアップデート対象のパッケージ一覧を見たり、</p>

<p><code>
aptitude purge '~i~n 3.2.0-2[1-3]'
</code></p>

<p>のような指定で古いカーネル関連のパッケージを削除したりするのをよく使います。
<code>~i</code> がインストール済みのものという意味で、
<code>~n</code> はパッケージ名の検索で引数は正規表現なのですが、
ここでは他に間違ってマッチしそうなものはないため、
<code>.</code> のエスケープは省略してしまうことが多いです。
<code>linux-.*</code> の部分も指定しなくても充分絞り込めるので
省略してしまっています。</p>

<p><code>~i</code> は引数をとらなくて、デフォルトはパッケージ名の検索なので、
<code>~i 3.2.0-2[1-3]</code> と省略することも出来ます。</p>

<h2>応用例</h2>

<h3>別 apt-line で入れたパッケージの検索など</h3>

<p>たとえば Ubuntu なら</p>

<p><code>
aptitude search '~i!~Oubuntu'
</code></p>

<p>のように Origin が Ubuntu 以外のパッケージという検索で
Ubuntu の apt-line 以外から入れたパッケージが検索できます。</p>

<p>昔から使い続けている Debian なら</p>

<p><code>
aptitude search '~i!~Odebian'
</code></p>

<p>で他の apt-line からインストールしたものに加えて、
昔の Debian にパッケージが存在して、
今の Debian にはもう収録されていないパッケージが残っているものも
探すことも出来ます。</p>

<h3>exim から postfix への入れ替え</h3>

<p><code>aptitude install</code> や <code>aptitude purge</code> で
パッケージを指定する時に末尾に <code>_</code> を付けると <code>purge</code> できたり、
<code>+</code> を付けるとインストールできたりします。</p>

<p>これらを組み合わせると <code>postfix+</code> でインストールしつつ、
名前に <code>exim</code> を含むパッケージを <code>purge</code> することで
<code>default-mta</code> や <code>mail-transport-agent</code> に依存しているパッケージの
依存関係が満たせないと言われずにパッケージの入れ替えができます。</p>

<p><code>
sudo aptitude purge '~i~nexim' postfix+
</code></p>

<h3>バグがあったパッケージのインストールを止めたい</h3>

<p>Debian の unstable や testing を使っていて
<code>apt-listbugs</code> を入れていると
インストール前にこのパッケージの
このバージョンは入れない方が
良さそうということがありますが、
同じソースパッケージで複数のパッケージに分かれていると
指定が面倒なことがあります。</p>

<p>たとえば <code>sysv-rc</code> でバグがあった時に
<code>apt-get source sysv-rc</code> でソースパッケージ名を調べて、
対象パッケージを確認した上で
以下のように
<code>aptitude forbid-version</code>
でそのバージョンはインストールしない、
ということが出来ます。</p>

<p><code>
aptitude search '?installed ?source-package(sysvinit)'
sudo aptitude forbid-version '?installed ?source-package(sysvinit)'
</code></p>

<h3>その他いろいろ</h3>

<p>最後にその他のいろいろな例を列挙しておきます。
詳しい説明は <code>aptitude</code> のリファレンスなどを参照してください。</p>

<ul>
<li><code>aptitude search '?maintainer(uwabami)</code> : メンテナで探す</li>
<li><code>aptitude search '~t minimal'</code> : タスクでインストールされるパッケージ</li>
<li><code>aptitude search '~n^lsb'</code> : 名前が lsb で始まるパッケージ</li>
<li><code>aptitude search '?section(metapackages)'</code> : メタパッケージ</li>
<li><code>aptitude search '?priority(important)'</code> : 優先度が重要のパッケージ</li>
<li><code>aptitude search '?provides(mail-transport-agent)'</code> : <code>mail-transport-agent</code> を提供しているパッケージ</li>
</ul>


<h2>まとめ</h2>

<p>今回は <code>aptitude</code> の検索パターンの便利な使い方を紹介しました。</p>

<p>今まで <code>apt-get</code> や <code>apt-cache</code> しか使っていなかったとか、
<code>aptitude</code> を使っていても単純にパッケージ名を指定しかしたことがなかったとか
いう人は <code>aptitude purge '~c'</code> だけでも試してみると良いのではないでしょうか。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VirtualBoxでdokkuを試した]]></title>
    <link href="http://blog.n-z.jp/blog/2013-11-15-dokku.html"/>
    <updated>2013-11-15T15:35:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/dokku</id>
    <content type="html"><![CDATA[<p>VirtualBox の中に Ubuntu 13.04 を入れて
<a href="https://github.com/progrium/dokku">dokku</a>
を試してみました。</p>

<p><a href="http://blog.coiney.com/2013/08/10/create-my-own-heroku/">dokku + VirtualBoxで自分のHerokuを作る</a>
を参考にしたのですが、
情報が古いのか、
README
に書いてあるのとコマンドが違うところ
(<code>gitreceive</code> が <code>sshcommand</code> になっているなど)
があるので、
README
の手順を基準にするのが良さそうです。</p>

<!--more-->


<h2>対象バージョン</h2>

<p>dokku の README に Ubuntu 13.10 と docker の組み合わせは
まだ問題があり、
13.04 が推奨と書いてあったので、
13.04 を使いました。</p>

<ul>
<li>ホストOS : OS X 10.9</li>
<li>VirtualBox 4.3.2</li>
<li>ゲストOS : Ubuntu 13.04 (amd64)</li>
<li>lxc-docker : 0.6.6</li>
<li>dokku : 今の master ブランチ (59ef6510bc)</li>
</ul>


<h2>Ubuntu 13.04 (amd64) のインストール</h2>

<p>OS のインストールは自分がこうしたというだけの話なので、
興味が無ければ dokku のインストールまで飛ばしてください。</p>

<p>いつものように
<a href="http://ftp.jaist.ac.jp/pub/Linux/ubuntu-releases/">Ubuntu Releases の jaist ミラー</a>
から
<code>ubuntu-13.04-server-amd64.iso</code>
をダウンロードしてインストールしました。</p>

<p>最初のユーザーは <code>adminuser</code> で、
<code>ssh</code> は後で入れるので、
パッケージのチェックは入れずにインストールしました。
ディスクは多めに 20GB に設定した以外はほぼデフォルトでインストールしました。</p>

<h3>etckeeper の設定</h3>

<ul>
<li><code>sudo aptitude install etckeeper git</code> で <code>git</code> と一緒にインストールして <code>bzr</code> をインストールしないようにします。
<code>bzr</code> がないので自動での <code>etckeeper init</code> は失敗するので、手動で実行します。</li>
<li><code>EDITOR=vi sudoedit /etc/etckeeper/etckeeper.conf</code> で <code>VCS="git"</code> と <code>GIT_COMMIT_OPTIONS="-v"</code> に変更します。</li>
<li><code>sudo etckeeper init</code> で初期化します。</li>
<li><code>sudo etckeeper commit "Initial commit"</code> で今の状態をコミットしておきます。</li>
<li><code>(cd /etc/ &amp;&amp; sudo git gc)</code> で <code>git gc</code> しておきます。</li>
</ul>


<h3>ufw の設定</h3>

<ul>
<li><code>/etc/default/ufw</code> の <code>DEFAULT_FORWARD_POLICY</code> を <code>DROP</code> から <code>ACCEPT</code> に変更しておきます。
<code>DROP</code> のままだと後で <code>docker</code> の中から DNS の解決ができないのが原因で <code>! [remote rejected] master -&gt; master (pre-receive hook declined)</code> になります。</li>
<li><code>sudo ufw enable</code> で有効にします。</li>
<li><code>sudo ufw allow 22/tcp</code> で <code>ssh</code> を許可します。</li>
<li><code>sudo ufw allow 80/tcp</code> で <code>http</code> を許可します。</li>
<li><code>sudo etckeeper commit "enable ufw"</code> などで変更を保存します。</li>
</ul>


<h3>ssh の設定</h3>

<ul>
<li><code>sudo aptitude install ssh</code> でインストールします。</li>
<li><code>/etc/hosts.deny</code> に <code>ALL: ALL</code> を追加してデフォルト拒否にします。</li>
<li><code>/etc/hosts.allow</code> に <code>sshd: 127.0.0.1 [::1]</code>
を追加してローカルホストからの接続を許可します。</li>
<li><code>/etc/hosts.allow</code> に <code>sshd: 10.0.0.0/8</code> も追加して
VirtualBox のポートフォワーディング経由の接続を許可します。</li>
<li><code>/etc/ssh/sshd_config</code> (<code>ssh_config</code> ではない) に
<code>AllowUsers adminuser</code> と <code>AllowUsers dokku</code> を追加して、
特定のユーザーにだけ <code>ssh</code> で接続できるようにします。</li>
</ul>


<p>ホストOS側では Vagrant も使っていたので、
ssh 用の鍵としては
<a href="https://github.com/mitchellh/vagrant/tree/master/keys">Vagrant の Insecure Keypair</a>
を使いました。</p>

<p>そして
ホストOS側の
<code>~/.ssh/config</code>
の設定としては、
グローバルの設定も含めると以下のようにしました。</p>

<p><code>
ExitOnForwardFailure yes
Ciphers aes256-ctr,aes192-ctr,aes128-ctr
HashKnownHosts no
NoHostAuthenticationForLocalhost yes
ServerAliveInterval 30
Host raring64
  Ciphers arcfour256,arcfour128
  HostName 127.0.0.1
  User adminuser
  Port 21304
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile ~/.vagrant.d/insecure_private_key
  IdentitiesOnly yes
</code></p>

<p><code>Ciphers</code> はデフォルトはセキュアなものを使い、
VM 用には速いものを使うようにしています。</p>

<h2>VirtualBox のポートフォワーディング設定</h2>

<p>設定のネットワークのポートフォワーディングのところで、</p>

<ul>
<li>名前:SSH, プロトコル:TCP, ホストIP:127.0.0.1, ホストポート:21304, ゲストIP:空欄, ゲストポート:22</li>
<li>名前:Web, プロトコル:TCP, ホストIP:127.0.0.1, ホストポート:1384, ゲストIP:空欄, ゲストポート:80</li>
</ul>


<p>のような感じで設定しました。</p>

<p>13.10 にしたら</p>

<ul>
<li>名前:SSH, プロトコル:TCP, ホストIP:127.0.0.1, ホストポート:21310, ゲストIP:空欄, ゲストポート:22</li>
<li>名前:Web, プロトコル:TCP, ホストIP:127.0.0.1, ホストポート:1380, ゲストIP:空欄, ゲストポート:80</li>
</ul>


<p>とすれば良いかなと思っています。</p>

<h2>dokku のインストール</h2>

<p><a href="https://github.com/progrium/dokku/blob/1d3ae29ba6bed8e1c98991c15db45724508fae30/README.md">README</a>
に書いてあるように
<code>wget -qO- https://raw.github.com/progrium/dokku/master/bootstrap.sh | sudo bash</code>
などでインストールできます。</p>

<p>実際には、
内容を確認したかったので、
<code>wget</code> でダウンロードした後、
<code>sudo bash &lt; bootstrap.sh</code>
で実行しました。</p>

<p>時間は5分程度かかると書いてありますが、
実際には
<code>docker</code>
用のイメージのダウンロードに時間がかかるので、
ネットワークの速度の影響が大きいようです。</p>

<h2>dokku の設定</h2>

<h3>VHOST の設定</h3>

<p>参考にしたサイトと同じように <code>xip.io</code> を使いました。
ポートフォワーディング経由にしているので、
<code>127.0.0.1</code>
にしています。</p>

<p><code>
echo deploy.127.0.0.1.xip.io | sudo tee /home/dokku/VHOST
</code></p>

<h3>ssh 公開鍵の追加</h3>

<p><code>ssh</code>
の接続は Vagrant と共通の鍵を使うことにしたので、
<code>/home/adminuser/.ssh/authorized_keys</code>
には <code>vagrant.pub</code> と同じ内容が入っています。</p>

<p>この鍵をそのまま <code>dokku</code> の方に登録しました。</p>

<p>ここもゲストOS側での作業になります。
README の手順では <code>ssh</code> 経由で <code>sudo</code> を実行しています。</p>

<p><code>
cat ~/.ssh/authorized_keys | sudo sshcommand acl-add dokku vagrant
</code></p>

<p>この手順で追加した公開鍵は</p>

<p><code>
sudo sshcommand acl-remove dokku vagrant
</code></p>

<p>で削除できます。</p>

<p>他の公開鍵を追加する時は <code>vagrant</code> の部分を変更しておかないと
<code>acl-remove</code> でまとめて削除されてしまいます。</p>

<h2>アプリケーションの deploy</h2>

<p>問題なく設定できていれば以下で deploy できます。</p>

<p>```</p>

<pre><code>git clone https://github.com/heroku/node-js-sample
cd node-js-sample
git remote add raring64 dokku@raring64:node-js-app
git push raring64 master
</code></pre>

<p>```</p>

<p>エラーになったときはログをみたり、
<code>dmesg</code>
を見たりして原因を調べてください。</p>

<p>正常に deploy できていれば
<code>http://node-js-app.deploy.127.0.0.1.xip.io:1384</code>
で <code>Hello World!</code> と表示されます。</p>

<h2>リモートからの dokku コマンド</h2>

<p>README には <code>$ dokku run node-js-app ls -alh</code> と書いてあり、
ホストOS側には <code>dokku</code> コマンドはないので、
どうすればいいのか悩んだのですが、</p>

<p><code>
 ssh dokku@raring64 run node-js-app ls -alh
</code></p>

<p>のように <code>git push</code> に使う <code>ssh</code> 経由で
<code>dokku</code> コマンドが実行されているのを使えました。</p>

<p>入力待ちになってしまうようで、
<code>control+D</code> で <code>EOF</code> を入力するなどしないと
ホストOS側のプロンプトに戻ってこないので、
想定された使い方ではなさそうな感じです。</p>

<p>他にも</p>

<p><code>
 ssh dokku@raring64 delete node-js-app
</code></p>

<p>でアプリケーションの削除もできました。
heroku と違って確認なしにいきなり削除されてしまうので注意が必要です。</p>

<p>どんなコマンドが実行できるのかは <code>dokku help</code> 相当の</p>

<p><code>
 ssh dokku@raring64 help
</code></p>

<p>で一覧が出てきます。</p>

<p>普段使いそうなのは <code>config</code> 関連と <code>logs</code> だと思いました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[/dev/snd/hwC0D0でPermission deniedになる問題を調べた]]></title>
    <link href="http://blog.n-z.jp/blog/2013-11-04-dev-snd-hwc0d0-permission-denied.html"/>
    <updated>2013-11-04T14:22:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/dev-snd-hwc0d0-permission-denied</id>
    <content type="html"><![CDATA[<p><code>/dev/snd/hwC0D0</code> を <code>O_RDWR</code> で <code>open(2)</code> するところで
<code>Permission denied</code> になるという話
(
<a href="https://twitter.com/takaswie/status/397014733494026240">ツイート</a>、
<a href="https://forums.ubuntulinux.jp/viewtopic.php?pid=100488#p100488">Ubuntu日本語フォーラム</a>
)
が気になったので、調べてみました。</p>

<!--more-->


<h2>結論</h2>

<p>最終的にどうすれば良いか知りたい人向けの情報としては、
<code>setcap cap_sys_rawio=ep filename</code>
でケーパビリティ (capability) を設定する、ということになります。</p>

<p>以下は、その結論にたどり着くまでに調べたことのメモです。</p>

<h2>パーミッションと ACL</h2>

<p><a href="http://blog.n-z.jp/blog/2013-10-27-kansai-debian-meeting.html">第 77 回 関西 Debian 勉強会に参加した</a>
で書いたように、
audio グループに属しているか、コンソールから直接ログインしていれば
パーミッションの問題はないはずです。</p>

<h2>余談: デバイスの sticky bit</h2>

<p><code>crw-rw---T</code> になっていて、
もしかして末尾の sticky bit が影響しているのかと思って調べてみたところ、
<a href="http://lists.debian.org/debian-user/2012/02/msg01273.html">Re: Sticky bit on device files?</a>
によると udev の管理用のフラグとして使われているようでした。
今回の件とは関係なさそうだったので、これ以上深追いはしていません。</p>

<h2>AppArmor</h2>

<p><code>/etc/apparmor.d/abstractions/audio</code> に
<code>/dev/snd/*      rw,</code> とあるので、
念のため
<code>sudo service apparmor stop</code>
で <code>AppArmor</code> を止めて試してみましたが、
変化が無かったので、
<code>sudo service apparmor start</code>
で戻しました。</p>

<h2>カーネルのソースコード探索</h2>

<p><code>strace</code> などで確認しても、
ユーザーランドでは <code>EACCES</code> が返ってくるとしかわからないので、
こうなったらカーネルのソースコードから <code>EACCES</code> を返しているところを
探すしかないということで、
<code>apt-get source linux-image-$(uname -r)</code>
でソースコードをダウンロードして探してみました。</p>

<p><code>grep -r EACCES sound</code> で探してみると
<code>sound/pci/hda/hda_hwdep.c</code> で以下のように
<code>CAP_SYS_RAWIO</code> をみていることがわかりました。</p>

<p>```c sound/pci/hda/hda_hwdep.c
 static int hda_hwdep_open(struct snd_hwdep <em>hw, struct file </em>file)
 {
 #ifndef CONFIG_SND_DEBUG_VERBOSE</p>

<pre><code>if (!capable(CAP_SYS_RAWIO))
    return -EACCES;
</code></pre>

<p> #endif</p>

<pre><code>return 0;
</code></pre>

<p> }
```</p>

<h2>Linux のケーパビリティ (capability)</h2>

<p><a href="http://linuxjm.sourceforge.jp/html/LDP_man-pages/man7/capabilities.7.html">Man page of CAPABILITIES</a>
が関係しているということがわかったところで、
設定方法も調べてみると、
<code>setcap</code> で設定できるとわかったので、
以下のような簡単なテストプログラムを用意して、
<code>sudo setcap cap_sys_rawio=ep ./a.out</code>
でケーパビリティを設定すると
<code>open(2)</code>
に成功するのを確認できました。
<code>cap_sys_rawio=ep</code> は危険そうなので、
テストプログラムとはいえ、
任意のパスを受け取れるようにするのは止めた方が良さそうに思いました。</p>

<p>```c open-hwC0D0.c
 #include &lt;sys/types.h>
 #include &lt;sys/stat.h>
 #include &lt;fcntl.h>
 #include &lt;stdio.h></p>

<p> int main() {</p>

<pre><code>open("/dev/snd/hwC0D0", O_RDWR);
perror("open");
return 0;
</code></pre>

<p> }
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[LC_COLLATEの問題でuniqで丸数字が同一視されてしまう]]></title>
    <link href="http://blog.n-z.jp/blog/2013-10-31-lc-collate-uniq.html"/>
    <updated>2013-10-31T23:50:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/lc-collate-uniq</id>
    <content type="html"><![CDATA[<p><code>uniq -c</code> で重複がないのを確認しようとしたら、
丸数字のところだけ違う行が同一視されてしまって、
2以上になることがあって困ったので、
原因を調べてみました。</p>

<!--more-->


<h2>現象</h2>

<p>以下のように丸数字などが同一視されています。</p>

<p><code>
$ cat n.txt
①
②
$ uniq n.txt
①
$ sort n.txt
①
②
$ tac n.txt | sort
②
①
$
</code></p>

<p>```
$ cat n.txt
①
②
$ LANG=ja_JP.utf8 uniq -c n.txt</p>

<pre><code>  2 ①
</code></pre>

<p>$ LANG=C uniq -c n.txt</p>

<pre><code>  1 ①
  1 ②
</code></pre>

<p>$ uniq &mdash;version
uniq (GNU coreutils) 8.20
Copyright &copy; 2012 Free Software Foundation, Inc.
ライセンス GPLv3+: GNU GPL version 3 or later <a href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.</p>

<p>作者 Richard M. Stallman および David MacKenzie。
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 13.04
Release:        13.04
Codename:       raring
$
```</p>

<h2>調査</h2>

<p><code>apt-get source locales</code>
でソースをとってきて調べてみると
<code>locales/ja_JP</code> の <code>LC_COLLATE</code> から <code>END LC_COLLATE</code>
の間に書いていないコードポイントは同一視されているように見えました。</p>

<p>これは glibc の問題だと思って、既に報告されているかどうか調べてみると
<a href="https://sourceware.org/bugzilla/show_bug.cgi?id=13063">Bug 13063 – &lsquo;sort -u&rsquo; will erase some Chinese characters</a>
に同じような話がありました。</p>

<h2>ML で聞いてみた</h2>

<p><a href="http://listserv.linux.or.jp/pipermail/linux-users/2013-October/000527.html">linux-users: 108951</a>
で質問してみたところ、
<a href="http://listserv.linux.or.jp/pipermail/linux-users/2013-October/000528.html">linux-users: 108952</a>
で返信があり、
<code>LC_COLLATE</code>
をちゃんと定義して解決するか、
単純にバイト順でソートしたいだけなら
<code>LC_COLLATE=C</code> で良いという話でした。</p>

<h2>結論</h2>

<p>結局今回の目的はソートではなく重複検査だったので、
<code>LC_COLLATE=C</code> で解決ということになりました。</p>

<p>誰か興味のある人は真面目に
<code>LC_COLLATE</code>
の定義に挑戦してみると良いのではないでしょうか。</p>

<p>それとは別に定義されていない文字を同一視せずにバイト順でも何でもいいので、
適当に別の文字として扱ってくれるようになればいいのに、
とは思いました。
誰かそういう方向での対応も挑戦してみると
他の言語も含めて幸せになれるのではないかと思いました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntuでの対応が悪いと感じた話]]></title>
    <link href="http://blog.n-z.jp/blog/2013-09-20-ubuntu-bugs-related-me.html"/>
    <updated>2013-09-20T19:43:00+09:00</updated>
    <id>http://blog.n-z.jp/blog/ubuntu-bugs-related-me</id>
    <content type="html"><![CDATA[<p>このエントリは愚痴が含まれます。
そういうのが嫌な人は読まない方が良いですよ。
警告しましたからね。</p>

<!--more-->


<p>結論としては、こういういろいろなことが積み重なって、
最近は ubuntu にはあまり積極的には貢献をしないようになった
という話です。</p>

<p>コミュニティ運営のアンチパターンの例として使えるのかもしれません。</p>

<p>最初の4項目は Ubuntu の Launchpad での話で、
後の2項目は ubuntu-jp での話です。</p>

<p>もちろん、対応が悪かったものだけ集めているので、
他の多数のバグの対応は良かったことが多いです。
全体的に Ubuntu のバグ対応は
Debian に比べると遅いという気はしますが。</p>

<h2>最近の例 (bind9)</h2>

<p>最初は Ubuntu 12.04 LTS の <code>bind9</code> の
<code>/etc/bind/db.root</code> が更新されない話です。</p>

<p>どういう話かというと
D-ROOT-SERVERS.NET に IPv6 アドレスが追加されて、
その後 IPv4 アドレスの変更があったのに <code>db.root</code> が
更新されないという話です。</p>

<p>ちょっと探して見つかっただけでも4個見つかります。
4個目のは3個目の重複という印がついてます。</p>

<ul>
<li><a href="https://launchpad.net/ubuntu/+source/bind9/+bug/1023600">db.root file outdated</a></li>
<li><a href="https://bugs.launchpad.net/ubuntu/+source/bind9/+bug/1160464">Bind db.root outdated, backport only the db.root file, for LTS important to keep db.root updated</a></li>
<li><a href="https://bugs.launchpad.net/ubuntu/+source/bind9/+bug/1090593">D.ROOT-SERVERS.NET changing January 3rd 2013</a></li>
<li><a href="https://bugs.launchpad.net/ubuntu/+source/bind9/+bug/1097050">d-root ipv4 has changed. Update db.root to show this</a></li>
</ul>


<p>IPv6 アドレスが追加された時点では重要ではないということで、
次の更新があれば一緒に更新するという反応だったようですが、
2013年1月3日に IPv4 アドレスが変更されて、
その後、移行期間として6ヶ月あったのですが、
それが終わった後も更新されないままです。</p>

<p>事前に見つけていた上2個のbugは移行期間中につつてみたりしたのですが、
全く反応がありませんでした。</p>

<p>そして未だに更新されていません。
これはひどいと思います。</p>

<h2>quick-fix?</h2>

<p><a href="https://bugs.launchpad.net/ubuntu-website-content/+bug/619920">Version mismatch of link in Code of Conduct</a>
で CoC の説明のバージョンが間違っていると指摘した時の話です。</p>

<p>一度 Confirmed になったのに Invalid になったというのが
嫌な印象を受けました。</p>

<h2>dbskkd-cdb を rebuild するだけの簡単なお仕事</h2>

<p><a href="https://bugs.launchpad.net/ubuntu/+source/dbskkd-cdb/+bug/58355">wrong reply via netkit-inetd</a>
で dbskkd-cdb を rebuild するだけで直るという報告をしたつもりだったのですが、
今見直してみると、こちらの反応がなかったのが悪かったようにも見えました。
追加情報を求められた時にはもう使ってなかったとはいえ、ちょっと反省。</p>

<h2>気付くのが遅すぎた</h2>

<p><a href="https://bugs.launchpad.net/ubuntu/+source/inspircd/+bug/978206">FreezeException request&mdash; Sync with Debian unstable</a>
で inspircd が古すぎて upstream の
セキュリティアップデートも出ないようなバージョンなので、
まずいんじゃないかと伝えてみたつもりだったんですが、
結局古いまま入ってしまいました。</p>

<p>古いまま入るぐらいなら消せば良かったのに、と思いましたが、
英語で書けなかった
(そもそも最初の説明も書けなかったのでリンクですませた)
ので、
自分で使うのは inspircd を止めて ngircd に乗り換えました。</p>

<h2>何もやってない (ように見える) 話</h2>

<p>「#ubuntu-jp IRCミーティングの議事録」というのが
ubuntu-jp の ML に流れるのですが、
アクションアイテムの冒頭が毎回同じで、
そこだけみると
(というかいつも最初の数行しかみてないのですが)
いつも何もしていないように見えるので、
順番を変えた方が良いんじゃないか、
というようなことを IRC とかで言ってみたことが
あるのですが、何も変わりませんでした。</p>

<h2>査読とは?</h2>

<p>アクションアイテムをもうちょっと下まで見た時に
<code>* [ ] 誰か査読して！</code>
と書いてあったので、
読んでみて返信してみたのですが、
次の週もそのままだったので、
あれは査読に含まれないのかと思ってがっかりしました。</p>
]]></content>
  </entry>
  
</feed>
